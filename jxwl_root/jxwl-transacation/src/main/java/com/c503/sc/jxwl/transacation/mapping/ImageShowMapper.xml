<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.c503.sc.jxwl.transacation.dao.IImageShowDao" >
  <resultMap id="BaseResultMap" type="com.c503.sc.jxwl.vehiclemonitor.bean.EnterpriseEntity" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="CORPORATE_NO" property="corporateNo" jdbcType="VARCHAR" />
    <result column="ENTERPRISE_NAME" property="enterpriseName" jdbcType="VARCHAR" />
    <result column="ENTERPRISE_TYPE" property="enterpriseType" jdbcType="VARCHAR" />
    <result column="CORPORATE_REP" property="corporateRep" jdbcType="VARCHAR" />
    <result column="ENTERPRISE_INTRODUCE" property="enterpriseIntroduce" jdbcType="VARCHAR" />
    <result column="REGISTER_OFFICE" property="registerOffice" jdbcType="VARCHAR" />
    <result column="LOGON_CAPITAL" property="logonCapital" jdbcType="DECIMAL" />
    <result column="MAJOR_BUSINESS_ROUTE" property="majorBusinessRoute" jdbcType="VARCHAR" />
    <result column="ESTABLISH_DATE" property="establishDate" jdbcType="DATE" />
    <result column="OPEN_ACCOUNT_BANK" property="openAccountBank" jdbcType="VARCHAR" />
    <result column="REGISTRATION_NO" property="registrationNo" jdbcType="VARCHAR" />
    <result column="PROFESSIONAL_WORK" property="professionalWork" jdbcType="VARCHAR" />
    <result column="TAXATION_NO" property="taxationNo" jdbcType="VARCHAR" />
    <result column="OPERATE_AREA" property="operateArea" jdbcType="VARCHAR" />
    <result column="ADDRESS" property="address" jdbcType="VARCHAR" />
    <result column="NETWORK_ADDR" property="networkAddr" jdbcType="VARCHAR" />
    <result column="VEHICLE_NUM" property="vehicleNum" jdbcType="DECIMAL" />
    <result column="TELEPHONE" property="telephone" jdbcType="VARCHAR" />
    <result column="CREATE_BY" property="createBy" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="UPDATE_BY" property="updateBy" jdbcType="VARCHAR" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="REMOVE" property="remove" jdbcType="CHAR" />
    <result column="FILEIDS" property="fileIds2" jdbcType="VARCHAR" />
  </resultMap>
  
  
  <sql id="Base_Column_List" >
    ID, CORPORATE_NO, ENTERPRISE_NAME, ENTERPRISE_TYPE, CORPORATE_REP, ENTERPRISE_INTRODUCE, 
    REGISTER_OFFICE, LOGON_CAPITAL, MAJOR_BUSINESS_ROUTE, ESTABLISH_DATE, OPEN_ACCOUNT_BANK, 
    REGISTRATION_NO, PROFESSIONAL_WORK, TAXATION_NO, OPERATE_AREA, ADDRESS, NETWORK_ADDR, 
    VEHICLE_NUM, TELEPHONE, CREATE_BY, CREATE_TIME, UPDATE_BY, UPDATE_TIME, REMOVE
  </sql>
  
 
  
  
  <!-- 查询时 -->
  <select id="findByNameOrCode" resultMap="BaseResultMap" parameterType="java.lang.String" >
    WITH T_VAL AS
	  (<include refid="query_fileIds" />)
   
	SELECT <include refid="Base_Column_List" />, T_VAL.FILEIDS
	  FROM T_ENTERPRISE, T_VAL
	  WHERE REMOVE = '0'
	  AND (CORPORATE_NO = #{queryStr}
	  OR ENTERPRISE_NAME = #{queryStr}
	  )
  </select>
  
  
  <sql id="query_fileIds">
  	SELECT LISTAGG(TB.FILE_ID, ';') WITHIN GROUP(ORDER BY TB.FILE_ID) AS FILEIDS
	    FROM T_ENTERPRISE TA
	    JOIN T_ENTERPRISE_FILE_RELA TB
	      ON TA.ID = TB.ENTERPRISE_ID
	     AND TB.REMOVE = '0'
	     AND (TA.CORPORATE_NO = #{value}
	      OR TA.ENTERPRISE_NAME LIKE CONCAT(CONCAT('%', #{value}), '%'))
  </sql>
  
  <!-- 初始化时: 根据输入法人代码精确查询企业信息-->
  <sql id="query_Column_List">
    TA.ID, TA.CORPORATE_NO, TA.ENTERPRISE_NAME, TA.ENTERPRISE_TYPE, TA.CORPORATE_REP,
    TA.ENTERPRISE_INTRODUCE, TA.REGISTER_OFFICE, TA.LOGON_CAPITAL, TA.MAJOR_BUSINESS_ROUTE,
    TA.ESTABLISH_DATE, TA.OPEN_ACCOUNT_BANK, TA.REGISTRATION_NO,  TA.PROFESSIONAL_WORK,
    TA.TAXATION_NO, TA.OPERATE_AREA, TA.ADDRESS, TA.NETWORK_ADDR, TA.VEHICLE_NUM, TA.TELEPHONE, T_VAL.FILEIDS
  </sql>
  
  <select id="findByCode" resultMap="BaseResultMap" parameterType="java.lang.String" >
	WITH T_VAL AS
	  (<include refid="query_fileIds" />)
	  
	SELECT <include refid="query_Column_List" />
	  FROM T_ENTERPRISE TA, T_VAL
	 WHERE TA.CORPORATE_NO = #{value}
	   AND TA.REMOVE = '0'
  </select>
  
   <select id="findByGOVER" resultType="java.lang.String" >
	SELECT CORPORATE_NO
    FROM (select CORPORATE_NO, CREATE_TIME
          from T_ENTERPRISE 
          WHERE REMOVE = '0'
         order by CREATE_TIME DESC)
    WHERE ROWNUM <![CDATA[<=]]> 1
  </select>
  
</mapper>
